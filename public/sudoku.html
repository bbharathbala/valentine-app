<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Sudoku Trap</title>
  <style>
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:#111;
      color:#fff;
      text-align:center;
      padding:22px 14px;
    }

    h1{ margin: 8px 0 6px; font-size: 34px; }
    h3{ margin: 0 0 14px; font-weight: 600; opacity: .9; }

    #timer{
      font-size: 28px;
      color:#ff4d4d;
      font-weight: 800;
      margin: 10px 0 10px;
    }

    .wrap{
      width: min(520px, 96vw);
      margin: 0 auto;
    }

    table{
      margin: 14px auto 0;
      border-collapse: collapse;
      background:#0f0f0f;
      border: 2px solid #444;
      border-radius: 10px;
      overflow:hidden;
    }

    td{
      border: 1px solid #444;
      width: 44px;
      height: 44px;
      padding:0;
    }

    /* thicker lines for 3x3 blocks */
    tr:nth-child(3) td, tr:nth-child(6) td { border-bottom: 2px solid #666; }
    td:nth-child(3), td:nth-child(6) { border-right: 2px solid #666; }

    input{
      width:100%;
      height:100%;
      border:none;
      outline:none;
      background:#1a1a1a;
      color:#fff;
      font-size:18px;
      font-weight: 700;
      text-align:center;
    }

    input:disabled{
      background:#121212;
      color:#e5e7eb;
      opacity: 1;
    }

    .note{
      margin-top: 10px;
      font-size: 14px;
      opacity: .75;
    }

    #final{
      display:none;
      margin-top: 18px;
    }

    #finalMessage{
      font-size: 28px;
      font-weight: 900;
      line-height: 1.25;
      margin: 0 0 14px;
    }

    #finalGif{
      display:none;
      width: min(520px, 92vw);
      border-radius: 14px;
      box-shadow: 0 10px 28px rgba(0,0,0,.45);
    }

    .debug{
      display:none;
      margin-top: 10px;
      font-size: 12px;
      opacity:.6;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="title">Sudoku</h1>
    <h3 id="subtitle">Solve this Sudoku in 60 seconds.</h3>
    <div id="timer">60</div>

    <table id="grid" aria-label="Sudoku grid"></table>

    <div class="note">Tip: It‚Äôs ‚Äúhard‚Äù for a reason üôÇ</div>

    <div id="final">
      <p id="finalMessage">You never had a choice.<br>You're stuck with me ‚ù§Ô∏è</p>
      <img id="finalGif" alt="meme gif" src="" />
    </div>

    <div class="debug" id="debug"></div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const GIF_YES = "./assets/yes.gif"; // local file
    const GIF_NO  = "./assets/no.gif";  // local file
    const DURATION_SECONDS = 60;

    // Intentionally impossible Sudoku (duplicate 5s in row 1)
    const PUZZLE = [
      [5,5,0,0,7,0,0,0,0],
      [6,0,0,1,9,5,0,0,0],
      [0,9,8,0,0,0,0,6,0],
      [8,0,0,0,6,0,0,0,3],
      [4,0,0,8,0,3,0,0,1],
      [7,0,0,0,2,0,0,0,6],
      [0,6,0,0,0,0,2,8,0],
      [0,0,0,4,1,9,0,0,5],
      [0,0,0,0,8,0,0,7,9]
    ];
    // ---------------------------

    // Parse mode
    const params = new URLSearchParams(window.location.search);
    const mode = (params.get("mode") || "no").toLowerCase(); // default to "no"

    const titleEl = document.getElementById("title");
    const timerEl = document.getElementById("timer");
    const gridEl = document.getElementById("grid");
    const finalEl = document.getElementById("final");
    const finalGif = document.getElementById("finalGif");
    const debugEl = document.getElementById("debug");

    // Title logic
    if (mode === "yes") {
      titleEl.textContent = "Not So Easy üòè";
    } else {
      titleEl.textContent = "Are You Sure? üòå";
    }

    // Optional debug (uncomment to diagnose)
    // debugEl.style.display = "block";
    // debugEl.textContent = "mode=" + mode + " url=" + window.location.href;

    // Build grid
    function buildGrid() {
      // clear
      gridEl.innerHTML = "";

      for (let r = 0; r < 9; r++) {
        const tr = document.createElement("tr");
        for (let c = 0; c < 9; c++) {
          const td = document.createElement("td");
          const input = document.createElement("input");

          input.setAttribute("inputmode", "numeric");
          input.setAttribute("maxlength", "1");
          input.setAttribute("aria-label", `Row ${r+1}, Column ${c+1}`);

          const v = PUZZLE[r][c];
          if (v !== 0) {
            input.value = String(v);
            input.disabled = true;
          } else {
            input.addEventListener("input", (e) => {
              // allow only 1-9
              const raw = e.target.value.replace(/[^1-9]/g, "");
              e.target.value = raw.slice(0, 1);
            });
          }

          td.appendChild(input);
          tr.appendChild(td);
        }
        gridEl.appendChild(tr);
      }
    }

    buildGrid();

    // Timer
    let timeLeft = DURATION_SECONDS;
    timerEl.textContent = String(timeLeft);

    const interval = setInterval(() => {
      timeLeft -= 1;
      timerEl.textContent = String(timeLeft);

      if (timeLeft <= 0) {
        clearInterval(interval);
        endTrap();
      }
    }, 1000);

    function endTrap() {
      // Hide puzzle & timer
      gridEl.style.display = "none";
      timerEl.style.display = "none";

      // Show final message + correct GIF
      finalEl.style.display = "block";
      finalGif.style.display = "block";
      finalGif.src = (mode === "yes") ? GIF_YES : GIF_NO;

      // Fallback if path wrong
      finalGif.onerror = () => {
        finalGif.style.display = "none";
      };
    }

    // Basic back-button trap
    history.pushState(null, "", window.location.href);
    window.addEventListener("popstate", () => {
      history.pushState(null, "", window.location.href);
    });
  </script>
</body>
</html>

